{"version":3,"file":"popover.js","sources":["../../src/popover.js"],"sourcesContent":["export default class Popover {\n    constructor(element) {\n        this.root = element;\n        this.trigger = this.root.querySelector(\"[data-popover-trigger]\");\n        this.content = this.root.querySelector(\"[data-popover-content]\");\n\n        this.setupAccessibility();\n        this.setupEventListeners();\n        this.setState(\"closed\"); // Initialize the state\n        this.isAnimating = false; // Flag to track animation state\n    }\n\n    generateId(prefix) {\n        return `${prefix}-${Math.random().toString(36).slice(2, 11)}`;\n    }\n\n    setAriaAttributes(element, attrs) {\n        Object.entries(attrs).forEach(([key, value]) => element?.setAttribute(key, value));\n    }\n\n    setupAccessibility() {\n        const { content, trigger } = this;\n\n        this.setAriaAttributes(content, {\n            role: \"dialog\",\n            id: this.generateId(\"popover-content\")\n        });\n\n        this.setAriaAttributes(trigger, {\n            \"aria-haspopup\": \"dialog\",\n            \"aria-expanded\": \"false\",\n            \"aria-controls\": content.id\n        });\n    }\n\n    setupEventListeners() {\n        this.trigger?.addEventListener(\"click\", (e) => {\n            e.stopPropagation();\n            this.toggle();\n        });\n        \n        // Use capturing for the document click listener\n        document.addEventListener(\"click\", this.handleDocumentClick.bind(this), true);\n\n        // Add global keydown event listener for Escape key\n        document.addEventListener(\"keydown\", this.handleGlobalKeyDown.bind(this));\n\n        // Prevent focus on trigger when hovering\n        this.trigger.addEventListener(\"mouseover\", (e) => {\n            e.preventDefault();\n            if (this.isOpen()) {\n                e.stopPropagation();\n            }\n        });\n    }\n\n    handleDocumentClick(e) {\n        // Check if the click is outside both the trigger and the content\n        if (!this.root.contains(e.target) && this.isOpen()) {\n            this.close();\n        }\n    }\n\n    handleGlobalKeyDown(e) {\n        if (e.key === \"Escape\" && this.isOpen()) {\n            this.close();\n            this.trigger.focus();\n        }\n    }\n\n    setState(state) {\n        this.content.setAttribute(\"data-state\", state);\n    }\n\n    toggle() {\n        this.isOpen() ? this.close() : this.open();\n    }\n\n    open() {\n        if (this.isAnimating) return; // Prevent opening if animation is already in progress\n\n        // Close all other open popovers first\n        document.querySelectorAll('[data-popover-content][data-state=\"open\"]').forEach(openPopover => {\n            if (openPopover !== this.content) {\n                openPopover.dispatchEvent(new CustomEvent('closePopover'));\n            }\n        });\n\n        this.content.classList.remove(\"hidden\");\n        this.trigger.setAttribute(\"aria-expanded\", \"true\");\n        this.setState(\"open\");\n\n        // Focus the first focusable element immediately after opening\n        const firstFocusableElement = this.getFirstFocusableElement();\n        if (firstFocusableElement) {\n            firstFocusableElement.focus();\n        }\n\n        const styles = window.getComputedStyle(this.content);\n        const hasEnterAnimation = styles.animationName !== 'none' && styles.display !== 'none';\n\n        if (hasEnterAnimation) {\n            this.isAnimating = true;\n            const handleAnimationEnd = () => {\n                this.isAnimating = false;\n                this.content.removeEventListener(\"animationend\", handleAnimationEnd);\n            };\n\n            this.content.addEventListener(\"animationend\", handleAnimationEnd);\n        }\n        // If there's no animation, we don't set isAnimating to true\n    }\n\n    close() {\n        if (this.isAnimating) return; // Prevent closing if animation is already in progress\n\n        this.setState(\"closed\");\n        this.trigger.setAttribute(\"aria-expanded\", \"false\");\n        \n        const styles = window.getComputedStyle(this.content);\n        const hasExitAnimation = styles.animationName !== 'none' && styles.display !== 'none';\n        if (hasExitAnimation) {\n            this.isAnimating = true; // Set isAnimating only if there's an animation\n            const handleAnimationEnd = () => {\n                this.content.classList.add(\"hidden\");\n                this.isAnimating = false;\n                this.content.removeEventListener(\"animationend\", handleAnimationEnd);\n            };\n            \n            this.content.addEventListener(\"animationend\", handleAnimationEnd);\n        } else {\n            // If there's no animation, immediately hide the content\n            this.content.classList.add(\"hidden\");\n            // We don't set isAnimating to true here since there's no animation\n        }\n    }\n\n\n    isOpen() {\n        return this.content.getAttribute(\"data-state\") === \"open\";\n    }\n\n    getFirstFocusableElement() {\n        const focusableElements = this.content.querySelectorAll(\n            'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n        );\n        return focusableElements.length > 0 ? focusableElements[0] : null;\n    }\n}"],"names":[],"mappings":"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"}