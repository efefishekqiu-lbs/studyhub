{"version":3,"file":"dialog.js","sources":["../../src/dialog.js"],"sourcesContent":["/*\nImplementation Notes for Dialog :\n\n1. Current Approach:\n   - We use the native <dialog> element to align with HTML standards.\n   - Custom open/close methods are implemented to add animation support.\n   - This approach prioritizes standards compliance and future-proofing.\n\n2. Animation Implementation:\n   - Currently overriding the showModal and close methods to handle animations.\n   - While keyframe animations are possible with <dialog>, they don't support animating the backdrop.\n   - Our current method allows us to animate both the dialog and its backdrop.\n\n3. Future Improvement with @starting-style:\n   - Once browser support improves, we plan to transition to the @starting-style at-rule.\n   - Syntax: @starting-style { dialog { opacity: 0; transform: scale(0.5); } }\n   - Animations will work natively with dialog.showModal() and dialog.close(). \n   - Will allow use of native dialog.showModal() and dialog.close() with animations. No more close() and open() methods in here anymore the animations will just work!\n\n4. Why <dialog>:\n   - Using <dialog> ensures long-term compatibility with evolving web standards.\n   - It simplifies maintenance as browsers improve native dialog implementation.\n   - While it presents some animation challenges now, it's a forward-looking choice.\n\n5. Current JavaScript Complexity:\n   - The current implementation requires JavaScript to handle animations and events.\n   - This includes managing animation states, intercepting form events, and custom open/close logic.\n   - @starting-style will allow us to move this logic to CSS, simplifying the JavaScript significantly.\n\nTODO: \n- Monitor browser support for @starting-style and update implementation when widely supported.\n- Plan refactoring to remove custom animation logic and event handling once @starting-style is implemented.\n\nResources:\nhttps://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog#animating_dialogs\nhttps://developer.mozilla.org/en-US/docs/Web/CSS/@starting-style\n*/\nexport default class Dialog {\n    constructor(element, options = {}) {\n        this.root = element;\n        this.dialog = this.root;\n        this.cancelButton = this.root.querySelector(\"[data-dialog-cancel]\");\n        this.title = this.root.querySelector(\"[data-dialog-title]\");\n        this.description = this.root.querySelector(\"[data-dialog-description]\");\n        this.isAnimating = false;\n        this.options = options;\n\n        this.setupAccessibility();\n        this.setupEventListeners();\n        this.attachCustomMethods();\n    }\n\n    generateId(prefix) {\n        return `${prefix}-${Math.random().toString(36).slice(2, 11)}`;\n    }\n\n    attachCustomMethods() {\n        this.originalCloseModal = this.dialog.close;\n        this.originalShowModal = this.dialog.showModal;\n        this.dialog.close = () => this.close();\n        this.dialog.showModal = () => this.open();\n    }\n\n    setAriaAttributes(element, attrs) {\n        if (element) {\n            Object.entries(attrs).forEach(([key, value]) => element.setAttribute(key, value));\n        }\n    }\n\n    setupAccessibility() {\n        const { dialog, title, description, options } = this;\n\n        this.setAriaAttributes(dialog, {\n            role: options.isAlert ? \"alertdialog\" : \"dialog\",\n            \"aria-modal\": \"true\",\n            \"aria-labelledby\": title ? this.generateId(\"dialog-title\") : \"\",\n            \"aria-describedby\": description ? this.generateId(\"dialog-description\") : \"\"\n        });\n\n        if (title) title.id = dialog.getAttribute(\"aria-labelledby\") || \"\";\n        else console.warn(\"Dialog is missing a title for accessibility.\");\n\n        if (description) description.id = dialog.getAttribute(\"aria-describedby\") || \"\";\n        else console.warn(\"Dialog is missing a description for accessibility.\");\n    }\n\n    setupEventListeners() {\n        this.cancelButton?.addEventListener(\"click\", () => this.close());\n        \n        this.dialog?.addEventListener(\"keydown\", (e) => {\n            if (e.key === \"Escape\") {\n                e.preventDefault();\n                this.close();\n            }\n        });\n\n        // Handle multiple form elements\n        const forms = this.dialog.querySelectorAll('form');\n        forms.forEach(form => {\n            form.addEventListener('submit', (e) => {\n                if (form.method === 'dialog') {\n                    e.preventDefault();\n                    this.close();\n                }\n            });\n        });\n    }\n\n    open() {\n        if (this.isAnimating) return;\n\n        this.originalShowModal.call(this.dialog);\n        this.setAriaAttributes(this.dialog, { \"data-state\": \"open\" });\n        document.body.style.overflow = 'hidden';\n\n        const styles = window.getComputedStyle(this.dialog);\n        const hasEnterAnimation = styles.animationName !== 'none' && styles.display !== 'none';\n\n        if (hasEnterAnimation) {\n            this.isAnimating = true;\n            const handleAnimationEnd = () => {\n                this.isAnimating = false;\n                this.dialog.removeEventListener(\"animationend\", handleAnimationEnd);\n            };\n            this.dialog.addEventListener(\"animationend\", handleAnimationEnd);\n        }\n    }\n\n    close() {\n        if (this.isAnimating) return;\n\n        this.setAriaAttributes(this.dialog, { \"data-state\": \"closed\" });\n        \n        const styles = window.getComputedStyle(this.dialog);\n        const hasExitAnimation = styles.animationName !== 'none' && styles.display !== 'none';\n\n        if (hasExitAnimation) {\n            this.isAnimating = true;\n            const handleAnimationEnd = () => {\n                this.finishClosing();\n                this.isAnimating = false;\n                this.dialog.removeEventListener(\"animationend\", handleAnimationEnd);\n            };\n            this.dialog.addEventListener(\"animationend\", handleAnimationEnd);\n        } else {\n            this.finishClosing();\n        }\n    }\n\n    finishClosing() {\n        this.originalCloseModal.call(this.dialog);\n        document.body.style.overflow = '';\n    }\n}\n"],"names":[],"mappings":"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"}